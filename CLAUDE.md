# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## –ü—Ä–æ–µ–∫—Ç

**78 –¥–Ω–µ–π —Å –¢—Ä–∞–Ω—Å–µ—Ä—Ñ–∏–Ω–≥–æ–º** ‚Äî Telegram-–±–æ—Ç –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è 78-–¥–Ω–µ–≤–Ω–æ–≥–æ –∫—É—Ä—Å–∞ –ø–æ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ –í–∞–¥–∏–º–∞ –ó–µ–ª–∞–Ω–¥–∞.

**–ö–ª—é—á–µ–≤–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è:** –ö—É—Ä—Å ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è. –ö–∞–∂–¥—ã–π –¥–µ–Ω—å = –æ–¥–Ω–æ –∑–∞–¥–∞–Ω–∏–µ. AI-–∫–æ—É—á –ø–æ–º–æ–≥–∞–µ—Ç —Å –ø—Ä–∞–∫—Ç–∏–∫–æ–π. –°–≤–æ–±–æ–¥–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Ä–∞–∑—Ä–µ—à—ë–Ω, –Ω–æ –±–æ—Ç –º—è–≥–∫–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ –∑–∞–¥–∞–Ω–∏—é –¥–Ω—è.

## User Journey

```
/start ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–∞–π–¥–∞ ‚Üí –ê–≤—Ç–æ—Å—Ç–∞—Ä—Ç –∫—É—Ä—Å–∞ (–î–µ–Ω—å 1)
    ‚Üì
–£—Ç—Ä–æ: –∑–∞–¥–∞–Ω–∏–µ –¥–Ω—è ‚Üí –î–µ–Ω—å: –æ–±—â–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∑–∞–¥–∞–Ω–∏—è ‚Üí –í–µ—á–µ—Ä: —á–µ–∫-–∏–Ω
    ‚Üì
78 –¥–Ω–µ–π ‚Üí –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Telegram ‚Üí N8N (Message Handler) ‚Üí DeepSeek API
                ‚Üì
            Supabase (user_profiles, conversation_history,
                      user_states, course_tasks, user_course_progress)
                ‚Üì
N8N (Morning/Evening Notifications) ‚Üí Telegram
```

## –°—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|------------|
| –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å | Telegram Bot |
| –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è | N8N (self-hosted) |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | Supabase |
| LLM | DeepSeek V3.2 |
| STT | Groq Whisper |

## N8N Workflows

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ |
|----|----------|
| `6l3pK1KtHcQTFLQq` | Main Bot Handler |
| `nPfhVXukqcwM5wYB` | Morning Notification |
| `IFdPkKABGZty03LS` | Evening Notification |
| `h6KhXemz0CzB1vmm` | **Test Workflow v5** (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏) |

**Instance:** https://n8n.rodkin.tech

### N8N MCP —Å–µ—Ä–≤–µ—Ä—ã

| MCP | –°—Ç–∞—Ç—É—Å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----|--------|------------|
| `n8n-kolesov` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | API N8N, –ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ workflow |
| `n8n-czlonkowski` | ‚ùå –ë–∞–≥ #492 | partial update —Å–ª–æ–º–∞–Ω |
| `n8n-ifmelate` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JSON (add_node, edit_node, delete_node) |

**–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º–∏ workflows:**

```
1. –°–∫–∞—á–∞—Ç—å workflow –∏–∑ N8N (kolesov get_workflow –∏–ª–∏ export)
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ workflow_data/{name}.json
3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ ifmelate:
   - add_node (+ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ connections)
   - edit_node
   - delete_node
   - add_connection
4. –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ kolesov update_workflow
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ ifmelate:**
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–¥ –ø–æ –æ–¥–Ω–æ–π (–Ω–µ –Ω—É–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å JSON –≤—Ä—É—á–Ω—É—é)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ connections
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ë—ç–∫–∞–ø workflow –≤ GitHub

**–ö–æ–≥–¥–∞ –¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø:**
- –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –Ω–æ–¥ (3+ –Ω–æ–¥)
- –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä—å—ë–∑–Ω—ã—Ö –±–∞–≥–æ–≤
- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã/connections
- –ü–µ—Ä–µ–¥ –∫—Ä—É–ø–Ω—ã–º–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞–º–∏

**–ö–æ–≥–¥–∞ –ù–ï –¥–µ–ª–∞—Ç—å:**
- –ú–µ–ª–∫–∏–µ –ø—Ä–∞–≤–∫–∏ —Ç–µ–∫—Å—Ç–∞/–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—á–∞—Ç–æ–∫
- –¢–µ—Å—Ç–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ö–∞–∫:**
1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å JSON –≤ `workflow_data/`
2. –ó–∞–ø—É—à–∏—Ç—å –≤ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

### –†–∞–±–æ—Ç–∞ —Å TODO.md

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏:**
1. –í –Ω–∞—á–∞–ª–µ —Ä–∞–±–æ—Ç—ã ‚Äî –ø—Ä–æ—á–∏—Ç–∞—Ç—å `TODO.md`, –ø–æ–Ω—è—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
2. –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ ‚Äî **—Å—Ä–∞–∑—É** –æ—Ç–º–µ—Ç–∏—Ç—å `[x]` –≤ TODO.md
3. –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª
4. –ü—Ä–∏ –±–ª–æ–∫–µ—Ä–∞—Ö/–ø—Ä–æ–±–ª–µ–º–∞—Ö ‚Äî –∑–∞–ø–∏—Å–∞—Ç—å –≤ "üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ" —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º

**–§–æ—Ä–º–∞—Ç:**
- `[ ]` ‚Äî –Ω–µ –Ω–∞—á–∞—Ç–æ
- `[x]` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
- `[-]` ‚Äî –æ—Ç–º–µ–Ω–µ–Ω–æ/–Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω–æ


## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Supabase

### –¢–∞–±–ª–∏—Ü—ã
- `user_profiles` ‚Äî –ø—Ä–æ—Ñ–∏–ª–∏ Telegram
- `conversation_history` ‚Äî –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- `user_states` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ (target_slide, importance_level)
- `course_tasks` ‚Äî 78 –∑–∞–¥–∞–Ω–∏–π –∫—É—Ä—Å–∞
- `user_course_progress` ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ö–ª—é—á–µ–≤—ã–µ RPC
- `start_course(telegram_id, program_id)` ‚Äî —Å—Ç–∞—Ä—Ç –∫—É—Ä—Å–∞
- `get_course_task(telegram_id)` ‚Äî —Ç–µ–∫—É—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ AI-–∫–æ—É—á–∞

**–ê–∫—Ç—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç:** `system-prompt-v3.md`

1. **–í—Å–µ–≥–¥–∞ –∑–Ω–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç:** —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å, –∑–∞–¥–∞–Ω–∏–µ, —Ü–µ–ª–µ–≤–æ–π —Å–ª–∞–π–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **–û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã** ‚Äî —Å–≤–æ–±–æ–¥–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Ä–∞–∑—Ä–µ—à—ë–Ω
3. **–ú—è–≥–∫–æ —Å–≤—è–∑—ã–≤–∞–µ—Ç —Å –ø—Ä–∞–∫—Ç–∏–∫–æ–π –¥–Ω—è** ‚Äî –µ—Å–ª–∏ —É–º–µ—Å—Ç–Ω–æ
4. **–ù–µ –Ω–∞–≤—è–∑—ã–≤–∞–µ—Ç** ‚Äî –ø—Ä—è–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ç—Ä–∞–Ω—Å–µ—Ä—Ñ–∏–Ω–≥—É –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é

–ü—Ä–∏–º–µ—Ä—ã:
- "–ë–µ—Å–∏—Ç –Ω–∞—á–∞–ª—å–Ω–∏–∫" ‚Üí –ø–æ–º–æ—â—å + —Å–≤—è–∑—å —Å –º–∞—è—Ç–Ω–∏–∫–∞–º–∏ (–µ—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –ø—Ä–æ —ç—Ç–æ)
- "–ö–∞–∫ —Å–Ω–∏–∑–∏—Ç—å –≤–∞–∂–Ω–æ—Å—Ç—å?" ‚Üí –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ —Ç–µ—Ö–Ω–∏–∫–µ
- "–ü—Ä–∏–≤–µ—Ç" ‚Üí "–ö–∞–∫ –ø—Ä–æ–¥–≤–∏–≥–∞–µ—Ç—Å—è —Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –ø—Ä–∞–∫—Ç–∏–∫–∞?"

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `/start` | –û–Ω–±–æ—Ä–¥–∏–Ω–≥ ‚Üí —Å–ª–∞–π–¥ ‚Üí –∞–≤—Ç–æ—Å—Ç–∞—Ä—Ç –∫—É—Ä—Å–∞ |
| `/slide` | –ü–æ–∫–∞–∑–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —Å–ª–∞–π–¥ |
| `/task` | –¢–µ–∫—É—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–Ω—è |
| `/progress` | –ü—Ä–æ–≥—Ä–µ—Å—Å (–¥–µ–Ω—å X –∏–∑ 78) |

## –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `TODO.md` | –¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏ –∏ —Å—Ç–∞—Ç—É—Å |
| `system-prompt-v3.md` | –ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç |
| `onboarding-prompts.md` | –¢–µ–∫—Å—Ç—ã 11 —à–∞–≥–æ–≤ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ |
| `78days_course/` | SQL —Å 78 –∑–∞–¥–∞–Ω–∏—è–º–∏ |
| `archive/transurfing-bot-instruction-v2.md` | –ê—Ä—Ö–∏–≤: —Å—Ç–∞—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è |

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### N8N
- UI: https://n8n.rodkin.tech
- API: https://n8n.rodkin.tech/api/v1/
- Header: `X-N8N-API-KEY`

### Supabase
- –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Supabase MCP
- DDL: `apply_migration`
- –ó–∞–ø—Ä–æ—Å—ã: `execute_sql`
